<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AwQDx8EjhKGBgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAACvElEQVQ4yz2RO3PbRgCEPxwOh+cdIRKUItLWyF0mkyJNuvyF/I/8rfTpU6RNk1RJnDiVHcuSJT8okQaIBw8HIAVtb7k7O7uz6333w8UkPQ8RQZIrADYvO7K5REaCh1cNWaEIleRgHe4wMY4QRYJ22yOEAP0owrYTQzPS7xwnp4quHmi2PUmm2G8sB+sQQjCOID0PmfqcfZkhiscx2+uW/DzETwSDgN6N2LrHthOjN2FOI9IiwrYD2SIgNpJ0rnh41SFunpVIz6P6Y8/dj1s+YX6RkM0lqQ4Yx5EPv1W8/emOdK4Y7cibv0rCSCC0k/S/lIQvfOYmg6f3mELRv7DEc0X/s8U97zlVkmK+ZPPrDn09IH/vif5rkVnbo3TK5fkZ3Sh4vZyI/3bcP4WTYGISPcF1yG3dIaXPoyTh4ZljtCUzc4H3/bdPplka4zMhw5irmxuiOMXzwPcmzpdLNtsdZVXiponJDWRZRhxKcq0RSeDRVA/MT3K6tmKWBCyyiK58g/QcXVuj/Iki1xQ6Jg09cDVSeFhrEbkxxElG07bkWmP0jCgK+fqrb4ijhKouATjYjmEcmKaRrms42A4A0bQNuTHcb96iVEjz0eCcQ/oSnRrev78FIFQRy+KLo24PAMgwUOzKkjxf8M+/f7JeXTI4x95abG9RgWK9ugTAGANAVc4+3y0PvUUIgdaa9eoSYwyutxwOR/4TbG8pyxJfCOJUI33JerVCAEhf0rQtWZoyDgNN23Ho7ZGvS17fvkQIgRscwziSmxlucFT7PUL68phgLbvyA+/e3QFQzBf4HxuYbEYSJ0hfks9m7Osak2VcXT1HKKWoyi1KKWzXoHXOerUCYLe7Z7V6zKI4oyx3n8c1xuCG8bjBsigYnEMFAVrnVNWOqtqRpIY8X+CcY1/vaduaNMlo25a62SMDhTYn/A8r0EqWZ1q2mQAAAABJRU5ErkJggg=="/>
<meta charset="utf-8">
<title>Minetest Mods</title>
<meta name="theme-color" content="#4caf50"/>
<style>
	html, body {
		width: 100%;
		height: 100%;
		margin: 0;
		padding: 0;
	}
	body {
		background: url(dirt_bg.png) fixed;
	}
	main {
		display: flex;
		justify-content: space-around;
		flex-wrap: wrap;
	}
	header {
		position: absolute;
		top: 0;
	}
	.mod {
		width: 300px;
		height: 200px;
		box-shadow: 0 2px 5px 0 rgba(0,0,0,.6);
		margin: 4px;
		padding: 4px;
		background-size: contain;
		background-position: 50% 50%;
		background-color: rgba(240,240,240,0.5);
		border-radius: 2px;
	}
	p {
		text-shadow: 1px 1px 0 black, -1px -1px 0 black,  1px -1px 0 black,  -1px 1px 0 black;
		font: 400 16px/24px Roboto,sans-serif;
		-webkit-font-smoothing: antialiased;
		color: white;
		display: block;
		-webkit-margin-before: 1em;
		-webkit-margin-after: 1em;
		-webkit-margin-start: 0px;
		-webkit-margin-end: 0px;
		margin: 16px 0;
		padding: 0;
	}
	a {
		-webkit-font-smoothing: antialiased;
		font: 400 16px/24px Roboto,sans-serif;
		cursor: auto;
		color: white;
		outline: 0;
		text-decoration: none;
	}
	h2 {
		text-shadow: 1px 1px 0 black, -1px -1px 0 black,  1px -1px 0 black,  -1px 1px 0 black;
		color: #ebebeb;
		-webkit-font-smoothing: antialiased;
		-webkit-margin-before: 0.83em;
		-webkit-margin-after: 0.83em;
		-webkit-margin-start: 0px;
		-webkit-margin-end: 0px;
		display: block;
		overflow: hidden;
		padding: 0;
		text-overflow: ellipsis;
		font: 300 24px/32px Roboto,sans-serif;
		letter-spacing: -.01em;
		margin: 40px 0 20px;
		padding-bottom: 3px;
		text-align: center;
		width: 100%;
	}
	h1 {
		text-shadow: 1px 1px 0 black, -1px -1px 0 black,  1px -1px 0 black,  -1px 1px 0 black;
		-webkit-font-smoothing: antialiased;
		-webkit-margin-start: 0px;
		-webkit-margin-end: 0px;
		-webkit-margin-before: 1em;
		-webkit-margin-after: 1em;
		overflow: hidden;
		padding: 0;
		text-overflow: ellipsis;
		color: white;
		font: 300 34px/40px Roboto,sans-serif;
		letter-spacing: -.01em;
		margin: 20px 0 10px;
		text-align: center;
		width: 100%;
	}
	pre {
		color: white;
		word-wrap: break-word;
		white-space: pre-wrap;
	}
	nav {
		display: flex;
		justify-content: center;
		flex-wrap: wrap;
	}
	#mod-image {
		image-rendering: pixelated;
		width: 100%;
		height: 66%;
	}
	.mod > h2, .mod > p {
		margin: 0;
		text-align: center;
	}
	#contributors {
		width: 100%;
		justify-content: space-around;
		display: flex;
		flex-wrap: wrap;
	}
	.contrubutor {
		flex-basis:content;
	}
	.butor-name {
		text-align: center;
		position: relative;
		bottom: 20px;
	}
	button {
		background-color: transparent;
		color: #fff;
		border: none;
		border-bottom-right-radius: 2px;
		border-bottom-left-radius: 2px;
		position: relative;
		height: 36px;
		margin: 0;
		min-width: 64px;
		padding: 0 16px;
		display: inline-block;
		font-family: "Roboto","Helvetica","Arial",sans-serif;
		font-size: 14px;
		font-weight: 500;
		text-transform: uppercase;
		letter-spacing: 0;
		overflow: hidden;
		will-change: box-shadow;
		transition: box-shadow .2s cubic-bezier(.4,0,1,1),background-color .2s cubic-bezier(.4,0,.2,1),color .2s cubic-bezier(.4,0,.2,1);
		outline: none;
		cursor: pointer;
		text-decoration: none;
		text-align: center;
		line-height: 36px;
		vertical-align: middle;
		-webkit-tap-highlight-color: rgba(255,255,255,0);
	}
	#download {
		box-sizing: border-box;
		position: fixed;
		bottom: 20px;
		right: 20px;
		width: 50px;
		height: 50px;
		padding: 13px;
		border-radius: 100%;
		background-color: #00e676;
		box-shadow: 0 2px 5px 0 rgba(0,0,0,.6);
		transition: ease-in-out 0.2s box-shadow background-color;
		-webkit-tap-highlight-color: rgba(255,255,255,0);
		z-index: 2;
	}
	.download:active {
		box-shadow: 0 2px 7px 0 rgba(0,0,0,.8);
		background-color: #00e070;
	}
	.current {
		background-color: #4caf50;
		box-shadow: 0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);
	}
    @media all and (min-width: 900px){
        #mod-image {
            width: 60%;
        }
    }
</style>
<script>
function get(url,callback) {
	var httpRequest = new XMLHttpRequest();
	httpRequest.onreadystatechange = (function() {
		if (httpRequest.readyState === XMLHttpRequest.DONE) {
			if (httpRequest.status === 200) {
				//alert(httpRequest.getResponseHeader("link"));
				callback(JSON.parse(httpRequest.responseText));
			} else {
				console.log("netwrok error ");
			}
		}
	}).bind(callback);
	httpRequest.open("GET", url);
	httpRequest.send(null);
}
var pageNo = 0;
var hashChange;
function onLoad() {
	(hashChange = function(e) {
		var hash = location.hash.slice(1);
		if (parseInt(hash)) { // is the hash a number? if so it is the page number.
			pageNo = parseInt(hash);
			get("https://api.github.com/organizations/16545761/repos?page="+pageNo,function(repos) {
				var main = document.querySelector("main");
				main.innerHTML = ""; // empty main so we can fill it with new mods
				for(var i in repos) {
					var url = repos[i].url;
					var div = document.createElement("div");
					div.onclick = (function(url) {location.hash = url}).bind(null,url);
					div.setAttribute("class","mod");
					div.innerHTML = "<h2 class='list'>"+repos[i].name+"</h2><p class='list'>"+repos[i].description+"</p>";
					div.style.backgroundImage = "url(https://github.com/"+repos[i].full_name+"/blob/master/screenshot.png?raw=true)";
					main.appendChild(div);
				}
				// ok let's add the buttons
				var reposPerPage = repos.length;
				get("https://api.github.com/orgs/minetest-mods",(function(minetest) {
					var totalPages = Math.ceil(minetest.public_repos/30);
					var nav = document.querySelector("nav");
					nav.innerHTML = "";
					for(var i=1; i<=totalPages; i++) {
						var button = document.createElement("button");
						button.onclick = (function(i) {location.hash = i}).bind(null,i);
						button.innerHTML = "page "+i;
						button.setAttribute("class",(pageNo==i)?"current":"");
						nav.appendChild(button);
					}
				}).bind(reposPerPage));
			});
		} else if (hash) { // is hash a string? if so it is the repo url
			get(hash,function(repo) {
				var main = document.querySelector("main");
				var nav = document.querySelector("nav");
				nav.innerHTML = ""; // empty nav
				main.innerHTML = ""; // empty main
				main.innerHTML += "<h1>"+repo.name+"</h1><h2>"+repo.description+"</h1>";
				main.innerHTML += "<img id='mod-image' src='https://github.com/"+repo.full_name+"/blob/master/screenshot.png?raw=true'/>";
				main.innerHTML += "<a id='download' href='https://github.com/"+repo.full_name+"/archive/master.zip'><svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path d='M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z'/></svg></a>";
				main.innerHTML += "<pre id='readme'></pre>";
				main.innerHTML += "<div id='contributors'></div>";
				get("https://api.github.com/repos/"+repo.full_name+"/readme",function(readme) {
					var p = document.getElementById("readme");
					p.innerHTML = atob(readme.content);
				});
				get("https://api.github.com/repos/"+repo.full_name+"/contributors",function(butors) {
					var contain = document.getElementById("contributors");
					contain.innerHTML += "<h2>Mod by:</h2>";
					for(var i in butors) {
						var butor = document.createElement("div");
						butor.className = "contrubutor";
						butor.innerHTML += "<img style='display:inline;width:150px;' src='"+butors[i].avatar_url+"'/><br/>";
						butor.innerHTML += "<p class='butor-name'>"+butors[i].login+"</p>";
						contain.appendChild(butor);
					}
				});
			});
		} else { // hash must be notheing. Show first page of mods
			location.hash  = 1;
		}
	})();
}
</script>
</head>
<body onload="onLoad()" onhashchange="hashChange()">
	<nav></nav>
	<main></main>
</body>
</html>